<div class="card shadow-sm mb-4">
    <form class="card-header py-3" id="product-filter-form">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
            
            <a href="/admin/products/new" class="btn btn-primary">
                <i class="fas fa-plus fa-sm"></i> Thêm Sản phẩm Mới
            </a>

            <div class="input-group" style="max-width: 400px;">
                <input type="text" name="q" id="product-search-input" class="form-control" placeholder="Tìm tên, SKU, slug..." value="<%= q %>">
                <button class="btn btn-primary" type="submit">
                    <i class="fas fa-search fa-sm"></i>
                </button>
            </div>
        </div>
    </form>
    
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-hover" id="dataTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Tên Sản phẩm</th>
                        <th>Thương hiệu</th>
                        <th>Danh mục</th>
                        <th>Giá (Base)</th>
                        <th>Kho (Tổng)</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody id="products-table-body">
                    <% if (products.length === 0) { %>
                        <tr>
                            <td colspan="6" class="text-center">Không tìm thấy sản phẩm nào.</td>
                        </tr>
                    <% } %>
                    <% products.forEach(product => { %>
                        <% const totalStock = (product.variants || []).reduce((acc, v) => acc + v.stock, 0); %>
                        <tr>
                            <td>
                                <strong><%= product.name %></strong><br>
                                <small class="text-muted">Slug: <%= product.slug %></small>
                            </td>
                            <td><%= product.brandId?.name || 'N/A' %></td>
                            <td><%= (product.categoryIds || []).map(c => c.name).join(', ') || 'N/A' %></td>
                            <td class="text-end"><%= (product.basePrice || 0).toLocaleString('vi-VN') %>đ</td>
                            <td class="text-center"><%= totalStock %></td>
                            <td class="text-center">
                                <a href="/admin/products/<%= product._id %>" class="btn btn-sm btn-info" title="Sửa">
                                    <i class="fas fa-pencil-alt"></i>
                                </a>
                                <form action="/admin/products/<%= product._id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Bạn có chắc muốn xóa sản phẩm này?');">
                                    <button type="submit" class="btn btn-sm btn-danger" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

        <nav class="pagination-wrap mt-4 d-flex justify-content-center" id="products-pagination">
            <% if (pagination.totalPages > 1) { %>
                <ul class="pagination">
                    <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                        <li class="page-item <%= (i === pagination.page ? 'active' : '') %>">
                            <a class="page-link" href="#"><%= i %></a>
                        </li>
                    <% } %>
                </ul>
            <% } %>
        </nav>
    </div>
</div>