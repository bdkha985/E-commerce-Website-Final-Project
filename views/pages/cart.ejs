<section class="cart-page container">
    <h1>Giỏ Hàng</h1>
    <p class="cart-subtitle">
        Bạn đang có <span id="cart-item-count"><%= (cartItems || []).length %></span> sản phẩm trong giỏ hàng
    </p>

    <div class="cart-layout">
        <div class="cart-main">
            <div class="cart-head">
                <div>Sản phẩm</div>
                <div class="t-center">Số lượng</div>
                <div class="t-right">Đơn giá</div>
                <div class="t-right">Tổng tiền</div>
                <div class="t-center">Xóa</div>
            </div>

            <div id="cart-body-items">
                <% if (cartItems && cartItems.length > 0) { %>
                    <% cartItems.forEach(item => { %>
                    <div class="cart-row" data-sku="<%= item.sku %>">
                        <div class="cart-prod">
                            <img src="<%= item.image || 'https://placehold.co/100x100?text=No+Img' %>" alt="<%= item.name %>" />
                            <div class="cart-prod-info">
                                <a class="name" href="/products/<%= item.slug %>">
                                    <%= item.name %>
                                </a>
                                <div class="variant">SKU: <%= item.sku %></div>
                            </div>
                        </div>

                        <div class="t-center">
                            <div class="qty-box">
                                <button class="btn-qty-down" data-sku="<%= item.sku %>" type="button">-</button>
                                <input type="text" class="qty-input" value="<%= item.quantity %>" data-sku="<%= item.sku %>" readonly>
                                <button class="btn-qty-up" data-sku="<%= item.sku %>" type="button">+</button>
                            </div>
                        </div>
                        
                        <div class="cart-price t-right">
                            <%= (item.price || 0).toLocaleString('vi-VN') %>đ
                        </div>

                        <div class="cart-total t-right">
                            <%= ((item.price || 0) * (item.quantity || 0)).toLocaleString('vi-VN') %>đ
                        </div>

                        <div class="t-center">
                            <button class="cart-remove" data-sku="<%= item.sku %>" aria-label="Xóa sản phẩm">
                                <i class="fa-regular fa-trash-can"></i>
                            </button>
                        </div>
                    </div>
                    <% }) %>
                <% } else { %>
                    <div class="empty-cart" id="empty-cart-message">
                        <div class="empty-cart-icon">
                            <i class="fa-solid fa-cart-shopping" style="font-size: 5rem; color: #cbd5e1;"></i>
                        </div>
                        <h2>Giỏ hàng của bạn đang trống</h2>
                        <p>Hãy khám phá thêm sản phẩm của chúng tôi!</p>
                        <a href="/products/all" class="btn" style="background: var(--primary-color); color: #fff;">Tiếp tục mua sắm</a>
                    </div>
                <% } %>
            </div>

            <% if (cartItems && cartItems.length > 0) { %>
            <div class="cart-actions">
                <a href="/products/all" class="btn-continue">
                    <i class="fa-solid fa-arrow-left"></i> Tiếp tục mua sắm
                </a>
                <button class="btn-clear-cart" id="btn-clear-all" style="background: #fef2f2; border-color: #fecaca; color: #ef4444;">
                    Xóa toàn bộ giỏ hàng
                </button>
            </div>
            <% } %>
        </div>

        <aside class="cart-summary">
            <h3>Tóm Tắt Đơn Hàng</h3>
            
            <div class="sum-row">
                <span>Tạm tính</span>
                <strong id="summary-subtotal">
                    <%= (cartSummary.subtotal || 0).toLocaleString('vi-VN') %>đ
                </strong>
            </div>

            <div class="discount-code">
                <h4>Mã giảm giá</h4>
                <div class="discount-input">
                    <input type="text" id="discount-input" placeholder="Nhập mã của bạn">
                    <button id="btn-apply-discount" type="button">Áp dụng</button>
                </div>
                <small id="discount-message" style="color: #ef4444; font-size: 1.3rem; margin-top: 5px; display: block;"></small>
            </div>

            <div class="sum-row">
                <span>Phí vận chuyển</span>
                <strong id="summary-shipping">
                    <%= (cartSummary.shippingFee || 0).toLocaleString('vi-VN') %>đ
                </strong>
            </div>
            <div class="sum-row">
                <span>Thuế (VAT 8%)</span>
                <strong id="summary-tax">
                    <%= (cartSummary.tax || 0).toLocaleString('vi-VN') %>đ
                </strong>
            </div>

            <div class="sum-row total">
                <span>Tổng cộng</span>
                <span class="amount" id="summary-total">
                    <%= (cartSummary.total || 0).toLocaleString('vi-VN') %>đ
                </span>
            </div>

            <% if (cartItems && cartItems.length > 0) { %>
                <a class="btn-checkout" href="/checkout">TIẾN HÀNH THANH TOÁN</a>
            <% } else { %>
                <button class="btn-checkout" disabled style="opacity: 0.6; cursor: not-allowed;">TIẾN HÀNH THANH TOÁN</button>
            <% } %>
        </aside>
    </div>
</section>
